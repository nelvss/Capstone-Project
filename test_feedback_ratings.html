<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Feedback Ratings</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 30px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 5px;
        }
        .test-section h2 {
            color: #555;
            margin-bottom: 15px;
            font-size: 18px;
        }
        button {
            background: #dc3545;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        button:hover {
            background: #c82333;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 5px;
            display: none;
        }
        .result.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            display: block;
        }
        .result.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            display: block;
        }
        .info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .stats {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test Feedback Ratings System</h1>
        
        <div class="info">
            <strong>‚ÑπÔ∏è Info:</strong> This page tests the feedback rating system by adding sample data to your database.
            Make sure your server is running on <code>http://localhost:3000</code>
        </div>

        <div class="test-section">
            <h2>1. Add Sample Feedback with Ratings</h2>
            <p>Click to add 10 sample feedbacks with random ratings (1-5 stars):</p>
            <button onclick="addSampleFeedback()">Add 10 Sample Feedbacks</button>
            <div id="result1" class="result"></div>
        </div>

        <div class="test-section">
            <h2>2. Add Specific Rating Feedbacks</h2>
            <p>Add feedback with specific rating:</p>
            <button onclick="addRatingFeedback(5)">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (5 Stars)</button>
            <button onclick="addRatingFeedback(4)">‚≠ê‚≠ê‚≠ê‚≠ê (4 Stars)</button>
            <button onclick="addRatingFeedback(3)">‚≠ê‚≠ê‚≠ê (3 Stars)</button>
            <button onclick="addRatingFeedback(2)">‚≠ê‚≠ê (2 Stars)</button>
            <button onclick="addRatingFeedback(1)">‚≠ê (1 Star)</button>
            <div id="result2" class="result"></div>
        </div>

        <div class="test-section">
            <h2>3. Add Feedback Without Rating</h2>
            <p>Test feedback submission without rating (optional field):</p>
            <button onclick="addNoRatingFeedback()">Add Feedback (No Rating)</button>
            <div id="result3" class="result"></div>
        </div>

        <div class="test-section">
            <h2>4. Fetch All Feedback</h2>
            <p>Retrieve all feedbacks from database:</p>
            <button onclick="fetchFeedback()">Fetch Feedback</button>
            <div id="result4" class="result"></div>
        </div>

        <div class="stats" id="stats" style="display: none;">
            <h3>üìä Statistics</h3>
            <div id="statsContent"></div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:3000/api';

        const sampleMessages = [
            "Great service! Had an amazing time on the tour.",
            "The staff was very friendly and helpful.",
            "Beautiful locations and well-organized activities.",
            "Highly recommend this tour to everyone!",
            "Good experience overall, would come back again.",
            "The boat was comfortable and the guide was knowledgeable.",
            "Perfect day trip! Everything was perfect.",
            "Nice scenery but could be better organized.",
            "Worth the money, great value for what we got.",
            "Fantastic experience! Will definitely recommend to friends."
        ];

        async function addSampleFeedback() {
            const resultDiv = document.getElementById('result1');
            const button = event.target;
            button.disabled = true;
            button.textContent = 'Adding...';
            
            try {
                let successCount = 0;
                let errorCount = 0;

                for (let i = 0; i < 10; i++) {
                    const rating = Math.floor(Math.random() * 5) + 1; // Random 1-5
                    const message = sampleMessages[i];

                    const response = await fetch(`${API_BASE_URL}/submit-feedback`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ message, rating })
                    });

                    const result = await response.json();
                    if (result.success) {
                        successCount++;
                    } else {
                        errorCount++;
                    }
                }

                resultDiv.className = 'result success';
                resultDiv.textContent = `‚úÖ Successfully added ${successCount} feedbacks with ratings! (${errorCount} errors)`;
                
                setTimeout(() => fetchFeedback(), 1000);
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `‚ùå Error: ${error.message}`;
            } finally {
                button.disabled = false;
                button.textContent = 'Add 10 Sample Feedbacks';
            }
        }

        async function addRatingFeedback(rating) {
            const resultDiv = document.getElementById('result2');
            const button = event.target;
            button.disabled = true;
            
            const messages = {
                5: "Absolutely amazing! Best experience ever! ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê",
                4: "Very good service, would recommend! ‚≠ê‚≠ê‚≠ê‚≠ê",
                3: "Good overall, met expectations. ‚≠ê‚≠ê‚≠ê",
                2: "Could be better, needs improvement. ‚≠ê‚≠ê",
                1: "Not satisfied with the service. ‚≠ê"
            };

            try {
                const response = await fetch(`${API_BASE_URL}/submit-feedback`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        message: messages[rating],
                        rating: rating
                    })
                });

                const result = await response.json();
                
                if (result.success) {
                    resultDiv.className = 'result success';
                    resultDiv.textContent = `‚úÖ Added feedback with ${rating} star rating!`;
                    setTimeout(() => fetchFeedback(), 500);
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `‚ùå Failed: ${result.message}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `‚ùå Error: ${error.message}`;
            } finally {
                button.disabled = false;
            }
        }

        async function addNoRatingFeedback() {
            const resultDiv = document.getElementById('result3');
            const button = event.target;
            button.disabled = true;
            button.textContent = 'Adding...';

            try {
                const response = await fetch(`${API_BASE_URL}/submit-feedback`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        message: "This is feedback without a rating. Rating is optional!"
                    })
                });

                const result = await response.json();
                
                if (result.success) {
                    resultDiv.className = 'result success';
                    resultDiv.textContent = `‚úÖ Added feedback without rating!`;
                    setTimeout(() => fetchFeedback(), 500);
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `‚ùå Failed: ${result.message}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `‚ùå Error: ${error.message}`;
            } finally {
                button.disabled = false;
                button.textContent = 'Add Feedback (No Rating)';
            }
        }

        async function fetchFeedback() {
            const resultDiv = document.getElementById('result4');
            const statsDiv = document.getElementById('stats');
            const statsContent = document.getElementById('statsContent');
            const button = event.target;
            button.disabled = true;
            button.textContent = 'Fetching...';

            try {
                const response = await fetch(`${API_BASE_URL}/feedback`);
                const result = await response.json();
                
                if (result.success) {
                    const feedbacks = result.feedback;
                    const total = feedbacks.length;
                    const withRating = feedbacks.filter(f => f.rating).length;
                    const withoutRating = total - withRating;

                    // Calculate rating distribution
                    const distribution = { 5: 0, 4: 0, 3: 0, 2: 0, 1: 0 };
                    let totalRating = 0;
                    
                    feedbacks.forEach(f => {
                        if (f.rating) {
                            distribution[f.rating]++;
                            totalRating += f.rating;
                        }
                    });

                    const avgRating = withRating > 0 ? (totalRating / withRating).toFixed(2) : 0;

                    resultDiv.className = 'result success';
                    resultDiv.textContent = `‚úÖ Fetched ${total} feedbacks successfully!`;

                    statsDiv.style.display = 'block';
                    statsContent.innerHTML = `
                        <p><strong>Total Feedbacks:</strong> ${total}</p>
                        <p><strong>With Rating:</strong> ${withRating}</p>
                        <p><strong>Without Rating:</strong> ${withoutRating}</p>
                        <p><strong>Average Rating:</strong> ${avgRating} ‚≠ê</p>
                        <hr>
                        <p><strong>Star Distribution:</strong></p>
                        <p>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (5 Stars): ${distribution[5]}</p>
                        <p>‚≠ê‚≠ê‚≠ê‚≠ê (4 Stars): ${distribution[4]}</p>
                        <p>‚≠ê‚≠ê‚≠ê (3 Stars): ${distribution[3]}</p>
                        <p>‚≠ê‚≠ê (2 Stars): ${distribution[2]}</p>
                        <p>‚≠ê (1 Star): ${distribution[1]}</p>
                    `;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `‚ùå Failed to fetch feedback: ${result.message}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `‚ùå Error: ${error.message}. Make sure server is running!`;
            } finally {
                button.disabled = false;
                button.textContent = 'Fetch Feedback';
            }
        }
    </script>
</body>
</html>
